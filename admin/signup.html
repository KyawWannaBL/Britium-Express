<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Registration | Britium Express</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f6f9; height: 100vh; display: flex; align-items: center; justify-content: center; font-family: sans-serif; }
        .signup-card { background: white; padding: 40px; border-radius: 10px; width: 100%; max-width: 500px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); border-top: 5px solid #ff6b00; }
        .btn-register { background-color: #0d2c54; color: white; width: 100%; font-weight: bold; }
        .btn-register:hover { background-color: #071e3d; color: white; }
    </style>
</head>
<body>

    <div class="signup-card">
        <h4 class="fw-bold text-center mb-4">Register New Staff</h4>
        
        <form id="signupForm">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label small">Email</label>
                    <input type="email" id="regEmail" class="form-control" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label small">Phone</label>
                    <input type="text" id="regPhone" class="form-control" required>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label small">Password</label>
                <input type="password" id="regPass" class="form-control" required>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label small">Role</label>
                    <select id="regRole" class="form-select">
                        <option value="manager">Manager</option>
                        <option value="staff">Operation Staff</option>
                        <option value="driver">Driver</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label small text-danger fw-bold">Secret Code</label>
                    <input type="password" id="secretCode" class="form-control" placeholder="Required" required>
                </div>
            </div>

            <button type="submit" class="btn btn-register mt-2">Create Account</button>
        </form>
        
        <div id="regStatus" class="mt-3 text-center small fw-bold"></div>
        <div class="text-center mt-3"><a href="login.html" class="text-decoration-none small text-muted">Back to Login</a></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        // CONFIG HERE
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "britium-express.firebaseapp.com",
            databaseURL: "https://britium-express-default-rtdb.firebaseio.com",
            projectId: "britium-express",
            storageBucket: "britium-express.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        document.getElementById('signupForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            const phone = document.getElementById('regPhone').value;
            const role = document.getElementById('regRole').value;
            const secret = document.getElementById('secretCode').value;
            const status = document.getElementById('regStatus');

            // SECURITY CHECK
            if (secret !== "BRITIUM2026") {
                status.style.color = "red";
                status.innerText = "Invalid Secret Code. Authorization Failed.";
                return;
            }

            createUserWithEmailAndPassword(auth, email, pass)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Save detailed profile to DB
                    set(ref(db, 'users/' + user.uid), {
                        email: email,
                        role: role,
                        phone: phone,
                        createdAt: new Date().toISOString()
                    }).then(() => {
                        status.style.color = "green";
                        status.innerText = "Success! Account Created.";
                        setTimeout(() => window.location.href = "login.html", 2000);
                    });
                })
                .catch((error) => {
                    status.style.color = "red";
                    status.innerText = error.message;
                });
        });
    </script>
</body>
</html>
